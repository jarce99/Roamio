customElements.get("compact-product-bundle")||customElements.define("compact-product-bundle",class extends HTMLElement{constructor(){super(),this.submitButton.addEventListener("click",this.onSubmitHandler.bind(this))}get variants(){return Array.from(this.querySelectorAll('form[is="product-bundle-form"] [name="id"]'))}get submitButton(){return this.querySelector("[data-product-bundle-submit]")}get cartDrawer(){return document.querySelector("cart-drawer")}onSubmitHandler(t){var e={items:this.variants.map(t=>({id:t.value,quantity:1}))};document.body.classList.contains("template-cart")||"page"===theme.settings.cartType?theme.utils.postLink2(theme.routes.cart_add_url,{parameters:{...e}}):(t.preventDefault(),this.submitButton.hasAttribute("aria-disabled")||(this.activeElement=t.submitter||t.currentTarget,this.handleErrorMessage(),t=[],document.documentElement.dispatchEvent(new CustomEvent("cart:bundled-sections",{bubbles:!0,detail:{sections:t}})),e=JSON.stringify({...e,sections:t,sections_url:window.location.pathname}),this.submitButton.setAttribute("aria-disabled","true"),this.submitButton.setAttribute("aria-busy","true"),fetch(""+theme.routes.cart_add_url,{...theme.utils.fetchConfig("javascript"),body:e}).then(t=>t.json()).then(async t=>{if(t.status)return this.handleErrorMessage(t.description),document.dispatchEvent(new CustomEvent("ajaxProduct:error",{detail:{errorMessage:t.description}})),(e=this.submitButton.querySelector(".btn-text span"))&&e.hasAttribute("data-sold-out")?(e.innerText=e.getAttribute("data-sold-out"),this.submitButton.setAttribute("aria-disabled","true"),void(this.error=!0)):void 0;var e=await(await fetch(theme.routes.cart_url,{...theme.utils.fetchConfig("json","GET")})).json();e.sections=t.sections,theme.pubsub.publish(theme.pubsub.PUB_SUB_EVENTS.cartUpdate,{source:"product-bundle",cart:e}),document.dispatchEvent(new CustomEvent("ajaxProduct:added",{detail:{product:t}})),this.cartDrawer?.show(this.activeElement)}).catch(t=>{console.log(t)}).finally(()=>{this.submitButton.removeAttribute("aria-busy"),this.error||this.submitButton.removeAttribute("aria-disabled")})))}handleErrorMessage(t=!1){this.hideErrors||(this.errorMessage=this.errorMessage||this.querySelector(".product-form__error-message"),this.errorMessage&&(this.errorMessage.toggleAttribute("hidden",!t),this.errorMessage.innerText=t))}});